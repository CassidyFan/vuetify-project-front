import{p as J,aZ as Q,a_ as ee,i as ae,O as le,a$ as te,b0 as oe,c as se,j as re,b1 as ne,b2 as K,d as l,S as O,_ as ue,am as ie,I as i,r as de,o as W,a as ce,w as r,ak as me,F as pe,aW as ve,W as w,a9 as D,ah as L,aX as ge,D as fe,b as Ve,g as be,aY as ye,e as o,ae as ke,af as xe,aa as Ce,ag as Pe,ai as we,a7 as Ie,ac as $e,ad as Se,ab as Ue}from"./index-DmCA67Jn.js";import{c as Fe,a as j,d as Be,e as Ae,u as he,b as I,V as De}from"./vee-validate.esm-CHc4Anv1.js";import{b as H}from"./route-block-B_A1xBdJ.js";import{V as Me}from"./VContainer-BIeFWhqe.js";import{V as Re}from"./VRow-BO3gLcR0.js";import{V as z}from"./VCol-r7keVrk8.js";import{V as Te,a as qe}from"./VTextarea-DRXi9Ocd.js";import{m as Ne,b as X,a as _e}from"./VSelect-CQQnfeSC.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./VDataTable-Bmqm7ofe.js";import"./VPagination-CoOi2M4r.js";import"./VDivider-POa5kSPg.js";import"./VList-BBCp83YD.js";import"./VListItem-C_rH6MOn.js";import"./VSlideGroup-miiO1r-v.js";const Le=J({...Q(),...ee(Ne(),["inline"])},"VCheckbox"),je=ae()({name:"VCheckbox",inheritAttrs:!1,props:Le(),emits:{"update:modelValue":u=>!0,"update:focused":u=>!0},setup(u,f){let{attrs:v,slots:x}=f;const n=le(u,"modelValue"),{isFocused:$,focus:S,blur:U}=te(u),M=oe(),R=se(()=>u.id||`checkbox-${M}`);return re(()=>{const[C,T]=ne(v),V=K.filterProps(u),b=X.filterProps(u);return l(K,O({class:["v-checkbox",u.class]},C,V,{modelValue:n.value,"onUpdate:modelValue":c=>n.value=c,id:R.value,focused:$.value,style:u.style}),{...x,default:c=>{let{id:y,messagesId:k,isDisabled:m,isReadonly:F,isValid:q}=c;return l(X,O(b,{id:y.value,"aria-describedby":k.value,disabled:m.value,readonly:F.value},T,{error:q.value===!1,modelValue:n.value,"onUpdate:modelValue":P=>n.value=P,onFocus:S,onBlur:U}),x)}})}),{}}}),ze=u=>($e("data-v-cec59037"),u=u(),Se(),u),Ee=ze(()=>Ue("h1",{style:{color:"#41807c"}},"商品管理",-1)),Y={__name:"products",setup(u){const{apiAuth:f}=ve(),v=ie(),x=i(null),n=i({open:!1,id:""}),$=t=>{t?(n.value.id=t._id,V.value.value=t.name,b.value.value=t.price,c.value.value=t.description,y.value.value=t.category,k.value.value=t.sell):n.value.id="",n.value.open=!0},S=()=>{n.value.open=!1,T(),x.value.deleteFileRecord()},U=["生活用品","文具","周邊"],M=Fe({name:j().required("商品名稱必填"),price:Be().typeError("商品價格格式錯誤").required("商品價格必填").min(0,"商品價格不能小於 0"),description:j().required("商品說明必填"),category:j().required("商品分類必填").test("isCategory","商品分類錯誤",t=>U.includes(t)),sell:Ae()}),{handleSubmit:R,isSubmitting:C,resetForm:T}=he({validationSchema:M,initialValues:{name:"",price:0,description:"",category:"",sell:!0}}),V=I("name"),b=I("price"),c=I("description"),y=I("category"),k=I("sell"),m=i([]),F=i([]),q=R(async t=>{var a,d,e;if(!((a=m.value[0])!=null&&a.error)&&!(n.value.id.length===0&&m.value.length<1))try{const s=new FormData;s.append("name",t.name),s.append("price",t.price),s.append("description",t.description),s.append("category",t.category),s.append("sell",t.sell),m.value.length>0&&s.append("image",m.value[0].file),n.value.id===""?await f.post("/product",s):await f.patch("/product/"+n.value.id,s),v({text:n.value.id===""?"新增成功":"編輯成功",snackbarProps:{color:"#41807c"}}),S(),p(!0)}catch(s){console.log(s),v({text:((e=(d=s==null?void 0:s.response)==null?void 0:d.data)==null?void 0:e.message)||"發生錯誤",snackbarProps:{color:"#d65c28"}})}}),P=i(10),B=i([{key:"createdAt",order:"desc"}]),A=i(1),N=i([]),Z=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"價格",align:"center",sortable:!0,key:"price"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"操作",align:"center",sortable:!1,key:"action"}],_=i(!0),E=i(0),h=i(""),p=async t=>{var a,d,e,s;t&&(A.value=1),_.value=!0;try{const{data:g}=await f.get("/product/all",{params:{page:A.value,itemsPerPage:P.value,sortBy:((a=B.value[0])==null?void 0:a.key)||"createdAt",sortOrder:((d=B.value[0])==null?void 0:d.order)||"desc",search:h.value}});N.value.splice(0,N.value.length,...g.result.data),E.value=g.result.total}catch(g){console.log(g),v({text:((s=(e=g==null?void 0:g.response)==null?void 0:e.data)==null?void 0:s.message)||"發生錯誤",snackbarProps:{color:"red"}})}_.value=!1};p();const G=async t=>{var a,d;console.log("Deleting item with ID:",t._id);try{if(!confirm(`確定要刪除產品 "${t.name}" 嗎？`))return;await f.delete(`/product/${t._id}`),v({text:"刪除成功",snackbarProps:{color:"#41807c"}}),p(!0)}catch(e){console.log(e),v({text:((d=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:d.message)||"發生錯誤",snackbarProps:{color:"#d65c28"}})}};return(t,a)=>{const d=de("vue-file-agent");return W(),ce(pe,null,[l(Me,{class:"main-box"},{default:r(()=>[l(Re,null,{default:r(()=>[l(z,{cols:"12"},{default:r(()=>[Ee]),_:1}),l(z,{cols:"12"},{default:r(()=>[l(w,{color:"#41807c",onClick:a[0]||(a[0]=e=>$(null))},{default:r(()=>[D("新增商品")]),_:1})]),_:1}),l(z,{cols:"12"},{default:r(()=>[l(Te,{"items-per-page":P.value,"onUpdate:itemsPerPage":[a[4]||(a[4]=e=>P.value=e),a[7]||(a[7]=e=>p(!1))],"sort-by":B.value,"onUpdate:sortBy":[a[5]||(a[5]=e=>B.value=e),a[8]||(a[8]=e=>p(!1))],page:A.value,"onUpdate:page":[a[6]||(a[6]=e=>A.value=e),a[9]||(a[9]=e=>p(!1))],items:N.value,headers:Z,loading:_.value,"items-length":E.value,search:h.value,hover:""},{top:r(()=>[l(L,{label:"搜尋",modelValue:h.value,"onUpdate:modelValue":a[1]||(a[1]=e=>h.value=e),"append-icon":"mdi-magnify",onClickAppend:a[2]||(a[2]=e=>p(!0)),onKeydown:a[3]||(a[3]=ge(e=>p(!0),["enter"]))},null,8,["modelValue"])]),"item.image":r(({value:e})=>[l(fe,{src:e,height:"50px"},null,8,["src"])]),"item.sell":r(({value:e})=>[e?(W(),Ve(Ie,{key:0,icon:"mdi-check"})):be("",!0)]),"item.action":r(({item:e})=>[l(w,{icon:"mdi-lead-pencil",variant:"text",color:"#212879",onClick:s=>$(e)},null,8,["onClick"]),l(w,{icon:"mdi-delete",variant:"text",color:"#d65c28",onClick:s=>G(e)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),l(me,{modelValue:n.value.open,"onUpdate:modelValue":a[17]||(a[17]=e=>n.value.open=e),persistent:"",width:"500"},{default:r(()=>[l(De,{onSubmit:ye(o(q),["prevent"]),disabled:o(C)},{default:r(()=>[l(ke,null,{default:r(()=>[l(xe,null,{default:r(()=>[D(Ce(n.value.id?"編輯商品":"新增商品"),1)]),_:1}),l(Pe,null,{default:r(()=>[l(L,{label:"名稱",modelValue:o(V).value.value,"onUpdate:modelValue":a[10]||(a[10]=e=>o(V).value.value=e),"error-messages":o(V).errorMessage.value},null,8,["modelValue","error-messages"]),l(L,{label:"價格",type:"number",min:"0",modelValue:o(b).value.value,"onUpdate:modelValue":a[11]||(a[11]=e=>o(b).value.value=e),"error-messages":o(b).errorMessage.value},null,8,["modelValue","error-messages"]),l(_e,{label:"分類",items:U,modelValue:o(y).value.value,"onUpdate:modelValue":a[12]||(a[12]=e=>o(y).value.value=e),"error-messages":o(y).errorMessage.value},null,8,["modelValue","error-messages"]),l(je,{label:"上架",modelValue:o(k).value.value,"onUpdate:modelValue":a[13]||(a[13]=e=>o(k).value.value=e),"error-messages":o(k).errorMessage.value},null,8,["modelValue","error-messages"]),l(qe,{label:"說明",modelValue:o(c).value.value,"onUpdate:modelValue":a[14]||(a[14]=e=>o(c).value.value=e),"error-messages":o(c).errorMessage.value},null,8,["modelValue","error-messages"]),l(d,{modelValue:m.value,"onUpdate:modelValue":a[15]||(a[15]=e=>m.value=e),"raw-model-value":F.value,"onUpdate:rawModelValue":a[16]||(a[16]=e=>F.value=e),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"選擇檔案或拖曳到這裡","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 1MB"},ref_key:"fileAgent",ref:x},null,8,["modelValue","raw-model-value"])]),_:1}),l(we,null,{default:r(()=>[l(w,{color:"#d65c28",loading:o(C),onClick:S},{default:r(()=>[D("取消")]),_:1},8,["loading"]),l(w,{color:"#212879",type:"submit",loading:o(C)},{default:r(()=>[D("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1},8,["modelValue"])],64)}}};typeof H=="function"&&H(Y);const sa=ue(Y,[["__scopeId","data-v-cec59037"]]);export{sa as default};

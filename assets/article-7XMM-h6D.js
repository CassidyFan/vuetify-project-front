import{_ as O,am as W,I as u,r as G,o as J,a as Q,d as l,w as r,ak as X,F as Y,aT as Z,W as c,a9 as S,ah as I,aU as ee,D as ae,aV as le,e as s,ae as te,af as oe,aa as re,ag as se,ai as ne,ac as ue,ad as ie,ab as de}from"./index-D8R_kbzg.js";import{c as me,a as P,u as pe,b as U,V as ve}from"./vee-validate.esm-Bkd51MnT.js";import{b as L}from"./route-block-B_A1xBdJ.js";import{V as ce}from"./VContainer-vcsyJ73I.js";import{V as ge}from"./VRow-CInxM5Cs.js";import{V as B}from"./VCol-BwPc_UoW.js";import{V as fe,a as Ve}from"./VTextarea-CYwdBZqf.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./VDataTable-B80CEqr1.js";import"./VPagination-XocsIPyh.js";import"./VSelect-BogbgrBc.js";import"./VList-rl_HIxec.js";import"./VListItem-DYFKPt6I.js";import"./VDivider-Dyo-3m8M.js";import"./VSlideGroup-BK5PbTn-.js";const be=g=>(ue("data-v-88b3487f"),g=g(),ie(),g),ye=be(()=>de("h1",{style:{color:"#41807c"}},"文章管理",-1)),N={__name:"article",setup(g){const{apiAuth:f}=Z(),v=W(),D=u(null),n=u({open:!1,id:""}),M=t=>{t?(n.value.id=t._id,V.value.value=t.title,b.value.value=t.content,y.value.value=t.author,k.value.value=t.url):(n.value.id="",_()),n.value.open=!0},T=()=>{n.value.open=!1,_(),D.value.deleteFileRecord()},z=me({title:P().required("標題必填"),content:P().required("內容必填"),author:P().required("作者必填"),url:P().url("網址格式錯誤").required("網址必填")}),{handleSubmit:K,isSubmitting:$,resetForm:_}=pe({validationSchema:z,initialValues:{title:"",content:"",author:"",url:""}}),p=u([]),q=u([]),V=U("title"),b=U("content"),y=U("author"),k=U("url"),j=K(async t=>{var a,i,e;if(!((a=p.value[0])!=null&&a.error)&&!(n.value.id.length===0&&p.value.length<1))try{const o=new FormData;o.append("title",t.title),o.append("content",t.content),o.append("author",t.author),o.append("url",t.url),p.value.length>0&&o.append("image",p.value[0].file),n.value.id===""?await f.post("/article",o):await f.patch("/article/"+n.value.id,o),v({text:n.value.id===""?"新增成功":"編輯成功",snackbarProps:{color:"#41807c"}}),T(),d(!0)}catch(o){console.log(o),v({text:((e=(i=o==null?void 0:o.response)==null?void 0:i.data)==null?void 0:e.message)||"發生錯誤",snackbarProps:{color:"#d65c28"}})}}),F=u(10),x=u([{key:"createdAt",order:"desc"}]),w=u(1),h=u([]),E=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"標題",align:"center",sortable:!0,key:"title"},{title:"作者",align:"center",sortable:!0,key:"author"},{title:"建立時間",align:"center",sortable:!0,key:"createdAt"},{title:"操作",align:"center",sortable:!1,key:"action"}],A=u(!0),R=u(0),C=u(""),d=async t=>{var a,i,e,o;t&&(w.value=1),A.value=!0;try{const{data:m}=await f.get("/article/all",{params:{page:w.value,itemsPerPage:F.value,sortBy:((a=x.value[0])==null?void 0:a.key)||"createdAt",sortOrder:((i=x.value[0])==null?void 0:i.order)||"desc",search:C.value}});h.value.splice(0,h.value.length,...m.result.data),R.value=m.result.total}catch(m){console.log(m),v({text:((o=(e=m==null?void 0:m.response)==null?void 0:e.data)==null?void 0:o.message)||"發生錯誤",snackbarProps:{color:"#d65c28"}})}A.value=!1};d();const H=async t=>{var a,i;console.log("Deleting item with ID:",t._id);try{if(!confirm(`確定要刪除文章 "${t.title}" 嗎？`))return;await f.delete(`/article/${t._id}`),v({text:"刪除成功",snackbarProps:{color:"#41807c"}}),d(!0)}catch(e){console.log(e),v({text:((i=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:i.message)||"發生錯誤",snackbarProps:{color:"#d65c28"}})}};return(t,a)=>{const i=G("vue-file-agent");return J(),Q(Y,null,[l(ce,{class:"main-box"},{default:r(()=>[l(ge,null,{default:r(()=>[l(B,{cols:"12"},{default:r(()=>[ye]),_:1}),l(B,{cols:"12"},{default:r(()=>[l(c,{color:"#41807c",onClick:a[0]||(a[0]=e=>M(null))},{default:r(()=>[S("新增文章")]),_:1})]),_:1}),l(B,{cols:"12"},{default:r(()=>[l(fe,{"items-per-page":F.value,"onUpdate:itemsPerPage":[a[4]||(a[4]=e=>F.value=e),a[7]||(a[7]=e=>d(!1))],"sort-by":x.value,"onUpdate:sortBy":[a[5]||(a[5]=e=>x.value=e),a[8]||(a[8]=e=>d(!1))],page:w.value,"onUpdate:page":[a[6]||(a[6]=e=>w.value=e),a[9]||(a[9]=e=>d(!1))],items:h.value,headers:E,loading:A.value,"items-length":R.value,search:C.value,hover:""},{top:r(()=>[l(I,{label:"搜尋",modelValue:C.value,"onUpdate:modelValue":a[1]||(a[1]=e=>C.value=e),"append-icon":"mdi-magnify",onClickAppend:a[2]||(a[2]=e=>d(!0)),onKeydown:a[3]||(a[3]=ee(e=>d(!0),["enter"]))},null,8,["modelValue"])]),"item.image":r(({value:e})=>[l(ae,{src:e,height:"50px"},null,8,["src"])]),"item.action":r(({item:e})=>[l(c,{icon:"mdi-lead-pencil",variant:"text",color:"#212879",onClick:o=>M(e)},null,8,["onClick"]),l(c,{icon:"mdi-delete",variant:"text",color:"#d65c28",onClick:o=>H(e)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),l(X,{modelValue:n.value.open,"onUpdate:modelValue":a[16]||(a[16]=e=>n.value.open=e),persistent:"",width:"500"},{default:r(()=>[l(ve,{onSubmit:le(s(j),["prevent"]),disabled:s($)},{default:r(()=>[l(te,null,{default:r(()=>[l(oe,null,{default:r(()=>[S(re(n.value.id?"編輯文章":"新增文章"),1)]),_:1}),l(se,null,{default:r(()=>[l(I,{label:"標題",modelValue:s(V).value.value,"onUpdate:modelValue":a[10]||(a[10]=e=>s(V).value.value=e),"error-messages":s(V).errorMessage.value},null,8,["modelValue","error-messages"]),l(Ve,{label:"內容",modelValue:s(b).value.value,"onUpdate:modelValue":a[11]||(a[11]=e=>s(b).value.value=e),"error-messages":s(b).errorMessage.value},null,8,["modelValue","error-messages"]),l(I,{label:"作者",modelValue:s(y).value.value,"onUpdate:modelValue":a[12]||(a[12]=e=>s(y).value.value=e),"error-messages":s(y).errorMessage.value},null,8,["modelValue","error-messages"]),l(I,{label:"網址",modelValue:s(k).value.value,"onUpdate:modelValue":a[13]||(a[13]=e=>s(k).value.value=e),"error-messages":s(k).errorMessage.value},null,8,["modelValue","error-messages"]),l(i,{modelValue:p.value,"onUpdate:modelValue":a[14]||(a[14]=e=>p.value=e),"raw-model-value":q.value,"onUpdate:rawModelValue":a[15]||(a[15]=e=>q.value=e),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"選擇檔案或拖曳到這裡","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 1MB"},ref_key:"fileAgent",ref:D},null,8,["modelValue","raw-model-value"])]),_:1}),l(ne,null,{default:r(()=>[l(c,{color:"#d65c28",loading:s($),onClick:T},{default:r(()=>[S("取消")]),_:1},8,["loading"]),l(c,{color:"#212879",type:"submit",loading:s($)},{default:r(()=>[S("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1},8,["modelValue"])],64)}}};typeof L=="function"&&L(N);const Te=O(N,[["__scopeId","data-v-88b3487f"]]);export{Te as default};

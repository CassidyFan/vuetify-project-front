import{a4 as q,u as B,E as k,c as f,a5 as w,w as a,o as c,b as o,a as v,a9 as l,R as n,a7 as i,at as u,au as D,an as N}from"./index-Bc_aKhA6.js";import{V as S}from"./VContainer-D6GJgDGy.js";import{V as d}from"./VCol-Bz3yVaOr.js";import{V as $}from"./VDivider-CI_AzGDe.js";import{V as A}from"./VDataTable-BfjtizPc.js";import"./VPagination-BI0-76m7.js";import"./VList-BQDOq1VX.js";const E=u("h1",{class:"text-center"},"購物車",-1),I={key:0},P={key:1,class:"text-red"},K={__name:"cart",setup(R){const{apiAuth:y}=D(),h=N(),p=q(),C=B(),r=k([]),V=[{title:"品名",key:"p_id.name"},{title:"單價",key:"p_id.price"},{title:"數量",key:"quantity"},{title:"總價",key:"total",value:e=>e.p_id.price*e.quantity},{title:"操作",key:"action"}];(async()=>{var e,s;try{const{data:t}=await y.get("/user/cart");r.value=t.result}catch(t){console.log(t),p({text:((s=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:s.message)||"發生錯誤",snackbarProps:{color:"red"}})}})();const x=f(()=>r.value.reduce((e,s)=>e+s.quantity*s.p_id.price,0)),g=f(()=>r.value.length>0&&!r.value.some(e=>!e.p_id.sell)),_=k(!1),b=async()=>{_.value=!0;const e=await C.checkout();p({text:e.text,snackbarProps:{color:e.color}}),e.color==="green"&&h.push("/orders"),_.value=!1};return(e,s)=>(c(),w(S,null,{default:a(()=>[o(d,{cols:"12"},{default:a(()=>[E]),_:1}),o($),o(d,{cols:"12"},{default:a(()=>[o(A,{items:r.value,headers:V},{"item.p_id.name":a(({item:t})=>[t.p_id.sell?(c(),v("span",I,l(t.p_id.name),1)):(c(),v("span",P,l(t.p_id.name)+" (已下架)",1))]),"item.quantity":a(({item:t})=>[o(n,{variant:"text",color:"red",onClick:m=>e.addCart(t.p_id._id,-1)},{default:a(()=>[i("-")]),_:2},1032,["onClick"]),u("span",null,l(t.quantity),1),o(n,{variant:"text",color:"green",onClick:m=>e.addCart(t.p_id._id,1)},{default:a(()=>[i("+")]),_:2},1032,["onClick"])]),"item.action":a(({item:t})=>[o(n,{variant:"text",color:"red",icon:"mdi-delete",onClick:m=>e.addCart(t.p_id._id,t.quantity*-1)},null,8,["onClick"])]),_:2},1032,["items"])]),_:1}),o(d,{cols:"12",class:"text-center"},{default:a(()=>[u("p",null,"總金額: "+l(x.value),1),o(n,{color:"green",disabled:!g.value,onClick:b},{default:a(()=>[i("結帳")]),_:1},8,["disabled"])]),_:1})]),_:1}))}};export{K as default};

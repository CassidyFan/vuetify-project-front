import{aQ as I,u as S,I as h,c as v,o as u,b as D,w as a,d as o,a as y,aa as l,W as n,a9 as p,ab as c,aW as N}from"./index-D9Je9GHE.js";import{S as _}from"./sweetalert2.all-B9kxGEux.js";import{V as $}from"./VContainer-Ch-4djFL.js";import{V as f}from"./VCol-Bu9a-Zlc.js";import{V as C}from"./VDivider-0ZMRKtFp.js";import{V as A}from"./VDataTable-BpNoVZaI.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./VPagination-yoTwScbh.js";import"./VSelect-DDDl8N2C.js";import"./VList-B4f-oeee.js";import"./VListItem-DPes0GZ3.js";import"./VSlideGroup-DC8xPM3j.js";const T=c("h1",{class:"text-center"},"購物車",-1),W={key:0},E={key:1,class:"text-red"},Q=c("br",null,null,-1),Y={__name:"cart",setup(R){const{apiAuth:x}=N(),g=I(),m=S(),s=h([]),w=[{title:"品名",key:"p_id.name"},{title:"單價",key:"p_id.price"},{title:"數量",key:"quantity"},{title:"總價",key:"total",value:t=>t.p_id.price*t.quantity},{title:"操作",key:"action"}];(async()=>{var t,r;try{const{data:e}=await x.get("/user/cart");s.value=e.result}catch(e){console.log(e),_.fire({title:((r=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:r.message)||"發生錯誤",icon:"error",showConfirmButton:!1,timer:2e3,background:"#f4f4f4",color:"#41807c",width:300})}})();const V=v(()=>s.value.reduce((t,r)=>t+r.quantity*r.p_id.price,0)),b=v(()=>s.value.length>0&&!s.value.some(t=>!t.p_id.sell)),k=h(!1),B=async()=>{k.value=!0;const t=await m.checkout();_.fire({title:t.text,icon:t.color==="red"?"error":"success",showConfirmButton:!1,timer:2e3,background:"#f4f4f4",color:"#41807c",width:300}),t.color==="green"&&g.push("/orders"),k.value=!1},d=async(t,r)=>{const e=await m.addCart(t,r);if(_.fire({title:e.text,icon:e.color==="red"?"error":"success",showConfirmButton:!1,timer:2e3,background:"#f4f4f4",color:"#41807c",width:300}),e.color==="green"){const i=s.value.findIndex(q=>q.p_id._id===t);s.value[i].quantity+=r,s.value[i].quantity<=0&&s.value.splice(i,1)}};return(t,r)=>(u(),D($,{class:"main-box"},{default:a(()=>[o(f,{cols:"12"},{default:a(()=>[T]),_:1}),o(C),o(f,{cols:"12"},{default:a(()=>[o(A,{items:s.value,headers:w},{"item.p_id.name":a(({item:e})=>[e.p_id.sell?(u(),y("span",W,l(e.p_id.name),1)):(u(),y("span",E,l(e.p_id.name)+" (已下架)",1))]),"item.quantity":a(({item:e})=>[o(n,{variant:"text",color:"red",onClick:i=>d(e.p_id._id,-1)},{default:a(()=>[p("-")]),_:2},1032,["onClick"]),c("span",null,l(e.quantity),1),o(n,{variant:"text",color:"green",onClick:i=>d(e.p_id._id,1)},{default:a(()=>[p("+")]),_:2},1032,["onClick"])]),"item.action":a(({item:e})=>[o(n,{variant:"text",color:"red",icon:"mdi-delete",onClick:i=>d(e.p_id._id,e.quantity*-1)},null,8,["onClick"])]),_:2},1032,["items"])]),_:1}),o(f,{cols:"12",class:"text-end"},{default:a(()=>[c("p",null,"總金額: "+l(V.value),1),o(C),Q,o(n,{color:"black",disabled:!b.value,onClick:B},{default:a(()=>[p("結帳")]),_:1},8,["disabled"])]),_:1})]),_:1}))}};export{Y as default};

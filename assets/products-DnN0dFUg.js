import{p as ne,av as be,aw as he,g as se,L as Ve,ax as ye,ay as ke,c as E,h as re,az as xe,aA as ee,b as l,O as G,t as L,aB as we,A as Ce,F as q,aC as Se,aD as Fe,E as p,z as De,P as Be,I as Ie,H as K,J as Te,aE as Re,aF as Ae,a0 as ie,aG as Ue,aH as Me,aI as He,aJ as Ne,am as ae,aK as Ee,C as Ge,G as $e,a4 as ze,r as Le,a as Oe,w as f,aL as qe,au as _e,o as de,R as Y,a7 as Z,aM as te,aN as je,V as Ke,a5 as Je,a6 as We,aO as Qe,d as v,as as Xe,ao as Ye,a9 as Ze,aq as ea,ar as aa,at as ta,a2 as la}from"./index-qWkza11C.js";import{c as oa,a as le,b as na,d as sa,u as ra,e as J,V as ua}from"./vee-validate.esm-w--V6E0Q.js";import{b as ce}from"./route-block-B_A1xBdJ.js";import{V as ia}from"./VContainer-Cq-d-irz.js";import{V as da}from"./VRow-DZN8H2Uj.js";import{V as oe}from"./VCol-_xHAf3DZ.js";import{m as ca,a as ve,b as va,c as ma,d as fa,e as ga,f as pa,g as ba,h as Va,u as ya,p as xa,i as Pa,j as ha,k as ka,l as wa,n as Ca,o as Sa,q as me,r as fe,s as ge,t as pe,v as Fa}from"./VDataTable-BbPZGVjJ.js";import{V as Da}from"./VDivider-D5WVbQnW.js";import"./VPagination-CebRQZ2m.js";import"./VList-oTI9LWZw.js";const Ba=ne({...be(),...he(ca(),["inline"])},"VCheckbox"),Ia=se()({name:"VCheckbox",inheritAttrs:!1,props:Ba(),emits:{"update:modelValue":e=>!0,"update:focused":e=>!0},setup(e,B){let{attrs:w,slots:o}=B;const r=Ve(e,"modelValue"),{isFocused:d,focus:h,blur:U}=ye(e),S=ke(),I=E(()=>e.id||`checkbox-${S}`);return re(()=>{const[T,M]=xe(w),C=ee.filterProps(e),g=ve.filterProps(e);return l(ee,G({class:["v-checkbox",e.class]},T,C,{modelValue:r.value,"onUpdate:modelValue":V=>r.value=V,id:I.value,focused:d.value,style:e.style}),{...o,default:V=>{let{id:y,messagesId:F,isDisabled:b,isReadonly:H,isValid:$}=V;return l(ve,G(g,{id:y.value,"aria-describedby":F.value,disabled:b.value,readonly:H.value},M,{error:$.value===!1,modelValue:r.value,"onUpdate:modelValue":R=>r.value=R,onFocus:h,onBlur:U}),o)}})}),{}}}),Ta=ne({itemsLength:{type:[Number,String],required:!0},...va(),...ma(),...fa()},"VDataTableServer"),Ra=se()({name:"VDataTableServer",props:Ta(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0},setup(e,B){let{attrs:w,slots:o}=B;const{groupBy:r}=ga(e),{sortBy:d,multiSort:h,mustSort:U}=pa(e),{page:S,itemsPerPage:I}=ba(e),T=E(()=>parseInt(e.itemsLength,10)),{columns:M,headers:C}=Va(e,{groupBy:r,showSelect:L(e,"showSelect"),showExpand:L(e,"showExpand")}),{items:g}=ya(e,M),{toggleSort:V}=xa({sortBy:d,multiSort:h,mustSort:U,page:S}),{opened:y,isGroupOpen:F,toggleGroup:b,extractRows:H}=Pa({groupBy:r,sortBy:d}),{pageCount:$,setItemsPerPage:R}=ha({page:S,itemsPerPage:I,itemsLength:T}),{flatItems:A}=ka(g,r,y),{isSelected:x,select:D,selectAll:z,toggleSelect:k,someSelected:P,allSelected:s}=wa(e,{allItems:g,currentPage:g}),{isExpanded:c,toggleExpand:n}=Ca(e),a=E(()=>H(g.value));Sa({page:S,itemsPerPage:I,sortBy:d,groupBy:r,search:L(e,"search")}),we("v-data-table",{toggleSort:V,sortBy:d}),Ce({VDataTableRows:{hideNoData:L(e,"hideNoData"),noDataText:L(e,"noDataText"),loading:L(e,"loading"),loadingText:L(e,"loadingText")}});const i=E(()=>({page:S.value,itemsPerPage:I.value,sortBy:d.value,pageCount:$.value,toggleSort:V,setItemsPerPage:R,someSelected:P.value,allSelected:s.value,isSelected:x,select:D,selectAll:z,toggleSelect:k,isExpanded:c,toggleExpand:n,isGroupOpen:F,toggleGroup:b,items:a.value.map(t=>t.raw),internalItems:a.value,groupedItems:A.value,columns:M.value,headers:C.value}));re(()=>{const t=me.filterProps(e),u=fe.filterProps(e),m=ge.filterProps(e),O=pe.filterProps(e);return l(pe,G({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},O),{top:()=>{var N;return(N=o.top)==null?void 0:N.call(o,i.value)},default:()=>{var N,_,W,Q,X,j;return o.default?o.default(i.value):l(q,null,[(N=o.colgroup)==null?void 0:N.call(o,i.value),!e.hideDefaultHeader&&l("thead",{key:"thead",class:"v-data-table__thead",role:"rowgroup"},[l(fe,G(u,{sticky:e.fixedHeader}),o)]),(_=o.thead)==null?void 0:_.call(o,i.value),!e.hideDefaultBody&&l("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[(W=o["body.prepend"])==null?void 0:W.call(o,i.value),o.body?o.body(i.value):l(ge,G(w,m,{items:A.value}),o),(Q=o["body.append"])==null?void 0:Q.call(o,i.value)]),(X=o.tbody)==null?void 0:X.call(o,i.value),(j=o.tfoot)==null?void 0:j.call(o,i.value)])},bottom:()=>o.bottom?o.bottom(i.value):!e.hideDefaultFooter&&l(q,null,[l(Da,null,null),l(me,t,{prepend:o["footer.prepend"]})])})})}}),Aa=ne({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...be(),...Se()},"VTextarea"),Ua=se()({name:"VTextarea",directives:{Intersect:Fe},inheritAttrs:!1,props:Aa(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,B){let{attrs:w,emit:o,slots:r}=B;const d=Ve(e,"modelValue"),{isFocused:h,focus:U,blur:S}=ye(e),I=E(()=>typeof e.counterValue=="function"?e.counterValue(d.value):(d.value||"").toString().length),T=E(()=>{if(w.maxlength)return w.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function M(s,c){var n,a;!e.autofocus||!s||(a=(n=c[0].target)==null?void 0:n.focus)==null||a.call(n)}const C=p(),g=p(),V=De(""),y=p(),F=E(()=>e.persistentPlaceholder||h.value||e.active);function b(){var s;y.value!==document.activeElement&&((s=y.value)==null||s.focus()),h.value||U()}function H(s){b(),o("click:control",s)}function $(s){o("mousedown:control",s)}function R(s){s.stopPropagation(),b(),ae(()=>{d.value="",Ee(e["onClick:clear"],s)})}function A(s){var n;const c=s.target;if(d.value=c.value,(n=e.modelModifiers)!=null&&n.trim){const a=[c.selectionStart,c.selectionEnd];ae(()=>{c.selectionStart=a[0],c.selectionEnd=a[1]})}}const x=p(),D=p(+e.rows),z=E(()=>["plain","underlined"].includes(e.variant));Be(()=>{e.autoGrow||(D.value=+e.rows)});function k(){e.autoGrow&&ae(()=>{if(!x.value||!g.value)return;const s=getComputedStyle(x.value),c=getComputedStyle(g.value.$el),n=parseFloat(s.getPropertyValue("--v-field-padding-top"))+parseFloat(s.getPropertyValue("--v-input-padding-top"))+parseFloat(s.getPropertyValue("--v-field-padding-bottom")),a=x.value.scrollHeight,i=parseFloat(s.lineHeight),t=Math.max(parseFloat(e.rows)*i+n,parseFloat(c.getPropertyValue("--v-input-control-height"))),u=parseFloat(e.maxRows)*i+n||1/0,m=$e(a??0,t,u);D.value=Math.floor((m-n)/i),V.value=Ge(m)})}Ie(k),K(d,k),K(()=>e.rows,k),K(()=>e.maxRows,k),K(()=>e.density,k);let P;return K(x,s=>{s?(P=new ResizeObserver(k),P.observe(x.value)):P==null||P.disconnect()}),Te(()=>{P==null||P.disconnect()}),re(()=>{const s=!!(r.counter||e.counter||e.counterValue),c=!!(s||r.details),[n,a]=xe(w),{modelValue:i,...t}=ee.filterProps(e),u=Re(e);return l(ee,G({ref:C,modelValue:d.value,"onUpdate:modelValue":m=>d.value=m,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":z.value},e.class],style:e.style},n,t,{centerAffix:D.value===1&&!z.value,focused:h.value}),{...r,default:m=>{let{id:O,isDisabled:N,isDirty:_,isReadonly:W,isValid:Q}=m;return l(Ae,G({ref:g,style:{"--v-textarea-control-height":V.value},onClick:H,onMousedown:$,"onClick:clear":R,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},u,{id:O.value,active:F.value||_.value,centerAffix:D.value===1&&!z.value,dirty:_.value||e.dirty,disabled:N.value,focused:h.value,error:Q.value===!1}),{...r,default:X=>{let{props:{class:j,...ue}}=X;return l(q,null,[e.prefix&&l("span",{class:"v-text-field__prefix"},[e.prefix]),ie(l("textarea",G({ref:y,class:j,value:d.value,onInput:A,autofocus:e.autofocus,readonly:W.value,disabled:N.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:b,onBlur:S},ue,a),null),[[Ue("intersect"),{handler:M},null,{once:!0}]]),e.autoGrow&&ie(l("textarea",{class:[j,"v-textarea__sizer"],id:`${ue.id}-sizer`,"onUpdate:modelValue":Pe=>d.value=Pe,ref:x,readonly:!0,"aria-hidden":"true"},null),[[Me,d.value]]),e.suffix&&l("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:c?m=>{var O;return l(q,null,[(O=r.details)==null?void 0:O.call(r,m),s&&l(q,null,[l("span",null,null),l(He,{active:e.persistentCounter||h.value,value:I.value,max:T.value,disabled:e.disabled},r.counter)])])}:void 0})}),Ne({},C,g,y)}}),Ma=ta("h1",{class:"text-center"},"商品管理",-1),Ha={__name:"products",setup(e){const{apiAuth:B}=_e(),w=ze(),o=p(null),r=p({open:!1,id:""}),d=n=>{n?(r.value.id=n._id,C.value.value=n.name,g.value.value=n.price,V.value.value=n.description,y.value.value=n.category,F.value.value=n.sell):r.value.id="",r.value.open=!0},h=()=>{r.value.open=!1,M(),o.value.deleteFileRecord()},U=["衣服","手機","遊戲","食品"],S=oa({name:le().required("商品名稱必填"),price:na().typeError("商品價格格式錯誤").required("商品價格必填").min(0,"商品價格不能小於 0"),description:le().required("商品說明必填"),category:le().required("商品分類必填").test("isCategory","商品分類錯誤",n=>U.includes(n)),sell:sa()}),{handleSubmit:I,isSubmitting:T,resetForm:M}=ra({validationSchema:S,initialValues:{name:"",price:0,description:"",category:"",sell:!0}}),C=J("name"),g=J("price"),V=J("description"),y=J("category"),F=J("sell"),b=p([]),H=p([]),$=I(async n=>{var a,i,t;if(!(b.value.length<1||(a=b.value[0])!=null&&a.error))try{const u=new FormData;u.append("name",n.name),u.append("price",n.price),u.append("description",n.description),u.append("category",n.category),u.append("sell",n.sell),u.append("image",b.value[0].file),b.value.length>0&&u.append("image",b.value[0].file),r.value.id===""?await B.post("/product",u):await B.patch("/product/"+r.value.id,u),w({text:r.value.id===""?"新增成功":"編輯成功",snackbarProps:{color:"green"}}),h(),c(!0)}catch(u){console.log(u),w({text:((t=(i=u==null?void 0:u.response)==null?void 0:i.data)==null?void 0:t.message)||"發生錯誤",snackbarProps:{color:"red"}})}}),R=p(10),A=p([{key:"createdAt",order:"desc"}]),x=p(1),D=p([]),z=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"價格",align:"center",sortable:!0,key:"price"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"操作",align:"center",sortable:!1,key:"action"}],k=p(!0),P=p(0),s=p(""),c=async n=>{var a,i,t,u;n&&(x.value=1),k.value=!0;try{const{data:m}=await B.get("/product/all",{params:{page:x.value,itemsPerPage:R.value,sortBy:((a=A.value[0])==null?void 0:a.key)||"createdAt",sortOrder:((i=A.value[0])==null?void 0:i.order)||"desc",search:s.value}});D.value.splice(0,D.value.length,...m.result.data),P.value=m.result.total}catch(m){console.log(m),w({text:((u=(t=m==null?void 0:m.response)==null?void 0:t.data)==null?void 0:u.message)||"發生錯誤",snackbarProps:{color:"red"}})}k.value=!1};return c(),(n,a)=>{const i=Le("vue-file-agent");return de(),Oe(q,null,[l(ia,null,{default:f(()=>[l(da,null,{default:f(()=>[l(oe,{cols:"12"},{default:f(()=>[Ma]),_:1}),l(oe,{cols:"12"},{default:f(()=>[l(Y,{color:"green",onClick:a[0]||(a[0]=t=>d(null))},{default:f(()=>[Z("新增商品")]),_:1})]),_:1}),l(oe,{cols:"12"},{default:f(()=>[l(Ra,{"items-per-page":R.value,"onUpdate:itemsPerPage":[a[4]||(a[4]=t=>R.value=t),a[7]||(a[7]=t=>c(!1))],"sort-by":A.value,"onUpdate:sortBy":[a[5]||(a[5]=t=>A.value=t),a[8]||(a[8]=t=>c(!1))],page:x.value,"onUpdate:page":[a[6]||(a[6]=t=>x.value=t),a[9]||(a[9]=t=>c(!1))],items:D.value,headers:z,loading:k.value,"items-length":P.value,search:s.value,hover:""},{top:f(()=>[l(te,{label:"搜尋",modelValue:s.value,"onUpdate:modelValue":a[1]||(a[1]=t=>s.value=t),"append-icon":"mdi-magnify",onClickAppend:a[2]||(a[2]=t=>c(!0)),onKeydown:a[3]||(a[3]=je(t=>c(!0),["enter"]))},null,8,["modelValue"])]),"item.image":f(({value:t})=>[l(Ke,{src:t,height:"50px"},null,8,["src"])]),"item.sell":f(({value:t})=>[t?(de(),Je(la,{key:0,icon:"mdi-check"})):We("",!0)]),"item.action":f(({item:t})=>[l(Y,{icon:"mdi-pencil",variant:"text",color:"blue",onClick:u=>d(t)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),l(qe,{modelValue:r.value.open,"onUpdate:modelValue":a[17]||(a[17]=t=>r.value.open=t),persistent:"",width:"500"},{default:f(()=>[l(ua,{onSubmit:Qe(v($),["prevent"]),disabled:v(T)},{default:f(()=>[l(Xe,null,{default:f(()=>[l(Ye,null,{default:f(()=>[Z(Ze(r.value.id?"編輯商品":"新增商品"),1)]),_:1}),l(ea,null,{default:f(()=>[l(te,{label:"名稱",modelValue:v(C).value.value,"onUpdate:modelValue":a[10]||(a[10]=t=>v(C).value.value=t),"error-messages":v(C).errorMessage.value},null,8,["modelValue","error-messages"]),l(te,{label:"價格",type:"number",min:"0",modelValue:v(g).value.value,"onUpdate:modelValue":a[11]||(a[11]=t=>v(g).value.value=t),"error-messages":v(g).errorMessage.value},null,8,["modelValue","error-messages"]),l(Fa,{label:"分類",items:U,modelValue:v(y).value.value,"onUpdate:modelValue":a[12]||(a[12]=t=>v(y).value.value=t),"error-messages":v(y).errorMessage.value},null,8,["modelValue","error-messages"]),l(Ia,{label:"上架",modelValue:v(F).value.value,"onUpdate:modelValue":a[13]||(a[13]=t=>v(F).value.value=t),"error-messages":v(F).errorMessage.value},null,8,["modelValue","error-messages"]),l(Ua,{label:"說明",modelValue:v(V).value.value,"onUpdate:modelValue":a[14]||(a[14]=t=>v(V).value.value=t),"error-messages":v(V).errorMessage.value},null,8,["modelValue","error-messages"]),l(i,{modelValue:b.value,"onUpdate:modelValue":a[15]||(a[15]=t=>b.value=t),"raw-model-value":H.value,"onUpdate:rawModelValue":a[16]||(a[16]=t=>H.value=t),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"選擇檔案或拖曳到這裡","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 1MB"},ref_key:"fileAgent",ref:o},null,8,["modelValue","raw-model-value"])]),_:1}),l(aa,null,{default:f(()=>[l(Y,{color:"red",loading:v(T),onClick:h},{default:f(()=>[Z("取消")]),_:1},8,["loading"]),l(Y,{color:"green",type:"submit",loading:v(T)},{default:f(()=>[Z("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1},8,["modelValue"])],64)}}};typeof ce=="function"&&ce(Ha);export{Ha as default};

import{_ as j,am as E,I as n,r as H,o as O,a as X,d as t,w as l,ak as Y,F as G,aW as J,W as v,a9 as w,ah as M,aX as Q,D as Z,aY as ee,e as d,ae,af as te,aa as le,ag as oe,ai as se,ac as re,ad as ne,ab as ie}from"./index-CLC46I6b.js";import{c as de,a as T,u as ue,b as h,V as me}from"./vee-validate.esm-RRjSmWKo.js";import{b as R}from"./route-block-B_A1xBdJ.js";import{V as pe}from"./VContainer-C6r91f5l.js";import{V as ce}from"./VRow-CVzLv4Yx.js";import{V as $}from"./VCol-aTZa13rv.js";import{V as ve,a as ge}from"./VTextarea-DGKrk3Wf.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./VDataTable-40nWvjqq.js";import"./VPagination-BoCzf2yi.js";import"./VSelect-XghLzl5w.js";import"./VList-DYjjmmlQ.js";import"./VListItem-Ch1tobx-.js";import"./VDivider-C7ylY0bg.js";import"./VSlideGroup-Dqu09c2m.js";const fe=g=>(re("data-v-35f08327"),g=g(),ne(),g),be=fe(()=>ie("h1",{style:{color:"#41807c"}},"看板管理",-1)),L={__name:"board",setup(g){const{apiAuth:f}=J(),c=E(),F=n(null),r=n({open:!1,id:""}),A=s=>{s?(r.value.id=s._id,b.value.value=s.name,V.value.value=s.description):(r.value.id="",D()),r.value.open=!0},B=()=>{r.value.open=!1,D(),F.value.deleteFileRecord()},N=de({name:T().required("名稱必填"),description:T().required("描述必填")}),{handleSubmit:q,isSubmitting:C,resetForm:D}=ue({validationSchema:N,initialValues:{name:"",description:""}}),p=n([]),U=n([]),b=h("name"),V=h("description"),z=q(async s=>{var a,i,e;if(!((a=p.value[0])!=null&&a.error)&&!(r.value.id.length===0&&p.value.length<1))try{const o=new FormData;o.append("name",s.name),o.append("description",s.description),p.value.length>0&&o.append("image",p.value[0].file),r.value.id===""?await f.post("/board",o):await f.patch("/board/"+r.value.id,o),c({text:r.value.id===""?"新增成功":"編輯成功",snackbarProps:{color:"#41807c"}}),B(),u(!0)}catch(o){console.log(o),c({text:((e=(i=o==null?void 0:o.response)==null?void 0:i.data)==null?void 0:e.message)||"發生錯誤",snackbarProps:{color:"#d65c28"}})}}),S=n(10),y=n([{key:"createdAt",order:"desc"}]),k=n(1),I=n([]),K=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"描述",align:"center",sortable:!0,key:"description"},{title:"建立時間",align:"center",sortable:!0,key:"createdAt"},{title:"操作",align:"center",sortable:!1,key:"action"}],P=n(!0),_=n(0),x=n(""),u=async s=>{var a,i,e,o;s&&(k.value=1),P.value=!0;try{const{data:m}=await f.get("/board/all",{params:{page:k.value,itemsPerPage:S.value,sortBy:((a=y.value[0])==null?void 0:a.key)||"createdAt",sortOrder:((i=y.value[0])==null?void 0:i.order)||"desc",search:x.value}});I.value.splice(0,I.value.length,...m.result.data),_.value=m.result.total}catch(m){console.log(m),c({text:((o=(e=m==null?void 0:m.response)==null?void 0:e.data)==null?void 0:o.message)||"發生錯誤",snackbarProps:{color:"#d65c28"}})}P.value=!1};u();const W=async s=>{var a,i;console.log("Deleting item with ID:",s._id);try{if(!confirm(`確定要刪除板塊 "${s.name}" 嗎？`))return;await f.delete(`/board/${s._id}`),c({text:"刪除成功",snackbarProps:{color:"#41807c"}}),u(!0)}catch(e){console.log(e),c({text:((i=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:i.message)||"發生錯誤",snackbarProps:{color:"#d65c28"}})}};return(s,a)=>{const i=H("vue-file-agent");return O(),X(G,null,[t(pe,{class:"main-box"},{default:l(()=>[t(ce,null,{default:l(()=>[t($,{cols:"12"},{default:l(()=>[be]),_:1}),t($,{cols:"12"},{default:l(()=>[t(v,{color:"#41807c",onClick:a[0]||(a[0]=e=>A(null))},{default:l(()=>[w("新增看板")]),_:1})]),_:1}),t($,{cols:"12"},{default:l(()=>[t(ve,{"items-per-page":S.value,"onUpdate:itemsPerPage":[a[4]||(a[4]=e=>S.value=e),a[7]||(a[7]=e=>u(!1))],"sort-by":y.value,"onUpdate:sortBy":[a[5]||(a[5]=e=>y.value=e),a[8]||(a[8]=e=>u(!1))],page:k.value,"onUpdate:page":[a[6]||(a[6]=e=>k.value=e),a[9]||(a[9]=e=>u(!1))],items:I.value,headers:K,loading:P.value,"items-length":_.value,search:x.value,hover:""},{top:l(()=>[t(M,{label:"搜尋",modelValue:x.value,"onUpdate:modelValue":a[1]||(a[1]=e=>x.value=e),"append-icon":"mdi-magnify",onClickAppend:a[2]||(a[2]=e=>u(!0)),onKeydown:a[3]||(a[3]=Q(e=>u(!0),["enter"]))},null,8,["modelValue"])]),"item.image":l(({value:e})=>[t(Z,{src:e,height:"50px"},null,8,["src"])]),"item.action":l(({item:e})=>[t(v,{icon:"mdi-lead-pencil",variant:"text",color:"#212879",onClick:o=>A(e)},null,8,["onClick"]),t(v,{icon:"mdi-delete",variant:"text",color:"#d65c28",onClick:o=>W(e)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),t(Y,{modelValue:r.value.open,"onUpdate:modelValue":a[14]||(a[14]=e=>r.value.open=e),persistent:"",width:"500"},{default:l(()=>[t(me,{onSubmit:ee(d(z),["prevent"]),disabled:d(C)},{default:l(()=>[t(ae,null,{default:l(()=>[t(te,null,{default:l(()=>[w(le(r.value.id?"編輯看板":"新增看板"),1)]),_:1}),t(oe,null,{default:l(()=>[t(M,{label:"名稱",modelValue:d(b).value.value,"onUpdate:modelValue":a[10]||(a[10]=e=>d(b).value.value=e),"error-messages":d(b).errorMessage.value},null,8,["modelValue","error-messages"]),t(ge,{label:"描述",modelValue:d(V).value.value,"onUpdate:modelValue":a[11]||(a[11]=e=>d(V).value.value=e),"error-messages":d(V).errorMessage.value},null,8,["modelValue","error-messages"]),t(i,{modelValue:p.value,"onUpdate:modelValue":a[12]||(a[12]=e=>p.value=e),"raw-model-value":U.value,"onUpdate:rawModelValue":a[13]||(a[13]=e=>U.value=e),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"選擇檔案或拖曳到這裡","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 1MB"},ref_key:"fileAgent",ref:F},null,8,["modelValue","raw-model-value"])]),_:1}),t(se,null,{default:l(()=>[t(v,{color:"#d65c28",loading:d(C),onClick:B},{default:l(()=>[w("取消")]),_:1},8,["loading"]),t(v,{color:"#212879",type:"submit",loading:d(C)},{default:l(()=>[w("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1},8,["modelValue"])],64)}}};typeof R=="function"&&R(L);const _e=j(L,[["__scopeId","data-v-35f08327"]]);export{_e as default};
